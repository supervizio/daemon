# C++ Skill - Programming Taxonomy
# Used by: agents/programming.md

language: cpp
taxonomy: programming
extensions: [".cpp", ".cc", ".cxx", ".hpp", ".hxx", ".h++"]

tools:
  quality:
    primary: clang-tidy
    secondary: cppcheck
  security:
    primary: semgrep
  types:
    primary: clang

axes:
  security:
    tools:
      - name: cppcheck
        rules:
          - bufferAccessOutOfBounds
          - invalidPrintfArgType_s
          - invalidScanfArgType_s
          - memleak
          - nullPointer
          - resourceLeak
          - uninitvar

      - name: semgrep
        rulesets:
          - "p/cpp"
          - "p/owasp-top-ten"

  quality:
    tools:
      - name: clang-tidy
        checks:
          # Modernize
          - modernize-avoid-bind
          - modernize-deprecated-headers
          - modernize-loop-convert
          - modernize-make-shared
          - modernize-make-unique
          - modernize-pass-by-value
          - modernize-raw-string-literal
          - modernize-redundant-void-arg
          - modernize-replace-auto-ptr
          - modernize-shrink-to-fit
          - modernize-use-auto
          - modernize-use-bool-literals
          - modernize-use-default-member-init
          - modernize-use-emplace
          - modernize-use-equals-default
          - modernize-use-equals-delete
          - modernize-use-noexcept
          - modernize-use-nullptr
          - modernize-use-override
          - modernize-use-using
          # Performance
          - performance-faster-string-find
          - performance-for-range-copy
          - performance-implicit-conversion-in-loop
          - performance-inefficient-string-concatenation
          - performance-move-const-arg
          - performance-move-constructor-init
          - performance-noexcept-move-constructor
          - performance-type-promotion-in-math-fn
          - performance-unnecessary-copy-initialization
          - performance-unnecessary-value-param
          # Readability
          - readability-avoid-const-params-in-decls
          - readability-braces-around-statements
          - readability-const-return-type
          - readability-container-size-empty
          - readability-delete-null-pointer
          - readability-else-after-return
          - readability-function-size
          - readability-identifier-naming
          - readability-implicit-bool-conversion
          - readability-inconsistent-declaration-parameter-name
          - readability-magic-numbers
          - readability-named-parameter
          - readability-non-const-parameter
          - readability-redundant-control-flow
          - readability-redundant-declaration
          - readability-redundant-member-init
          - readability-redundant-smartptr-get
          - readability-redundant-string-cstr
          - readability-redundant-string-init
          - readability-simplify-boolean-expr
          - readability-static-accessed-through-instance
          - readability-static-definition-in-anonymous-namespace
          - readability-string-compare
          # Bugprone
          - bugprone-argument-comment
          - bugprone-assert-side-effect
          - bugprone-branch-clone
          - bugprone-copy-constructor-init
          - bugprone-dangling-handle
          - bugprone-exception-escape
          - bugprone-fold-init-type
          - bugprone-forward-declaration-namespace
          - bugprone-forwarding-reference-overload
          - bugprone-inaccurate-erase
          - bugprone-incorrect-roundings
          - bugprone-integer-division
          - bugprone-macro-parentheses
          - bugprone-macro-repeated-side-effects
          - bugprone-misplaced-operator-in-strlen-in-alloc
          - bugprone-misplaced-widening-cast
          - bugprone-move-forwarding-reference
          - bugprone-multiple-statement-macro
          - bugprone-parent-virtual-call
          - bugprone-sizeof-container
          - bugprone-sizeof-expression
          - bugprone-string-constructor
          - bugprone-string-integer-assignment
          - bugprone-string-literal-with-embedded-nul
          - bugprone-suspicious-memset-usage
          - bugprone-suspicious-missing-comma
          - bugprone-suspicious-semicolon
          - bugprone-suspicious-string-compare
          - bugprone-swapped-arguments
          - bugprone-terminating-continue
          - bugprone-throw-keyword-missing
          - bugprone-undelegated-constructor
          - bugprone-undefined-memory-manipulation
          - bugprone-unhandled-self-assignment
          - bugprone-unused-raii
          - bugprone-unused-return-value
          - bugprone-use-after-move
          - bugprone-virtual-near-miss

    thresholds:
      function_size: 100
      cyclomatic_complexity: 15
      max_parameters: 6

patterns:
  bad:
    - pattern: 'gets\s*\('
      severity: CRITICAL
      rule: CWE-120
      message: "gets() is unsafe - use fgets() instead"

    - pattern: 'strcpy\s*\('
      severity: CRITICAL
      rule: CWE-120
      message: "strcpy() is unsafe - use strncpy() or strlcpy()"

    - pattern: 'sprintf\s*\('
      severity: CRITICAL
      rule: CWE-120
      message: "sprintf() is unsafe - use snprintf()"

    - pattern: 'strcat\s*\('
      severity: MAJOR
      rule: CWE-120
      message: "strcat() is unsafe - use strncat() or strlcat()"

    - pattern: 'scanf\s*\('
      severity: MAJOR
      rule: CWE-120
      message: "scanf() can overflow - specify width limits"

    - pattern: 'system\s*\('
      severity: CRITICAL
      rule: CWE-78
      message: "system() is vulnerable to command injection"

    - pattern: 'new\s+\w+\['
      severity: MINOR
      rule: modernize-make-unique
      message: "Prefer std::make_unique or std::vector"

    - pattern: 'delete\s+\w+;'
      severity: MINOR
      rule: use-smart-ptr
      message: "Prefer smart pointers over raw delete"

    - pattern: 'NULL\s*$'
      severity: MINOR
      rule: modernize-use-nullptr
      message: "Use nullptr instead of NULL"

    - pattern: '#define\s+\w+\s+\d+'
      severity: MINOR
      rule: modernize-constexpr
      message: "Consider constexpr instead of #define for constants"

  good:
    - pattern: "std::make_unique"
      message: "Using make_unique for unique_ptr"
    - pattern: "std::make_shared"
      message: "Using make_shared for shared_ptr"
    - pattern: "override"
      message: "Explicit override"
    - pattern: "noexcept"
      message: "Exception specification"
    - pattern: "const &"
      message: "Const reference parameter"
    - pattern: "constexpr"
      message: "Compile-time constant"
